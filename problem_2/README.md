# Problem 2: Even Fibonacci Numbers

**Problem source:** [Project Euler Problem 2](https://projecteuler.net/problem=2)

**Problem statement:**

Each new term in the **Fibonacci sequence** is generated by adding the previous two terms. By starting with $1$ and $2$, the first $10$ terms will be: $1, 2, 3, 5, 8, 13, 21, 34, 55, 89, \dots$.

By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the **even-valued terms**.

## Solution 1

### Approach

  - Use **Binet's Formula** to find the $n$-th even Fibonacci number directly.
  - The $n$-th even Fibonacci number is $E_n = F_{3n}$, which can be expressed using the Golden Ratio $\phi$ and its conjugate $\psi$:
    $$E_n = \frac{(\phi^3)^n - (\psi^3)^n}{\sqrt{5}}$$
  - Calculate the index $N$ of the last even term below the threshold ($4,000,000$).
  - Use the **formula for the sum of a geometric series** to sum all $N$ terms directly.

**Reference:** The full Python implementation is available in [`solution_3.py`](solution_3.py).

### Detailed Explanation

  - **Step 1: Constants and Even Fibonacci Recurrence**
      - **Golden Ratio:** $\phi = \frac{1+\sqrt{5}}{2}$
      - **Conjugate:** $\psi = \frac{1-\sqrt{5}}{2}$ 
      - The base for the geometric series for even terms are $r_1 = \phi^3$ and $r_2 = \psi^3$.
          - $r_1 = \phi^3$  (`ephi`)
          - $r_2 = \psi^3$  (`epsi`)
  - **Step 2: Finding the Index $N$**
      - The code uses a **logarithmic approximation** to quickly find an estimate (`n_cand`) for the index $N$ where $E_N \approx \text{threshold}$.
          - We solve $\frac{\mathbf{ephi}^N}{\sqrt{5}} \approx \text{threshold}$ for $N$:
            $$N \approx \frac{\ln(\text{threshold} \cdot \sqrt{5})}{\ln(\mathbf{ephi})}$$
      - Since this calculation involves a logarithm and floating-point math, the result (`n_cand`) is a good estimate but might be slightly above or exactly equal to the true index $N$ where $E_N$ first exceeds the threshold.

  - **Step 3: Refining the Index (Starting at `n_cand - 1`)**
      - The code sets the initial value for the counter $N$ to `n_cand - 1`: `N = n_cand - 1`.
      - **The purpose of starting at `n_cand - 1` is to guarantee that the first calculated even Fibonacci number ($E_N$) is below the threshold.**
      - Since `n_cand` is derived from an equation meant to find the boundary, starting one step before that boundary ensures the **`while E_N < threshold:`** loop is correctly initiated.
      - The **`while` loop** then iteratively increments $N$ and recalculates $E_N$ until $E_N$ is no longer less than the threshold 
  
  - **Step 4: Index Correction ($N -= 1$)**
    - When the loop terminates, the variable $N$ holds the value of the index of the term that exceeded the limit.
    - However, we need to sum only the terms up to the limit, which means we need a count of **N-1** terms.
    - The command `N -= 1` is executed to rewind the index by one.
    - This changes the value of **N**: $N=11$
  - **Step 5: Sum of Geometric Series**
      - The total sum $\sum_{n=1}^{N} E_n$ is:
        $$\text{Sum} = \frac{1}{\sqrt{5}} \left( \sum_{n=1}^{N} (\phi^3)^n - \sum_{n=1}^{N} (\psi^3)^n \right)$$
      - The sum of a geometric series $S_N = \sum_{n=1}^{N} r^n = \frac{r(r^N - 1)}{r - 1}$.
      - **Sum of Positive Part ($S_{\phi}$):** $r = \phi^3$
        $$S_{\phi} = \sum_{n=1}^{11} (\phi^3)^n = \frac{\phi^3 ((\phi^3)^{11} - 1)}{\phi^3 - 1}$$
      - **Sum of Negative Part ($S_{\psi}$):** $r = \psi^3$
        $$S_{\psi} = \sum_{n=1}^{11} (\psi^3)^n = \frac{\psi^3 ((\psi^3)^{11} - 1)}{\psi^3 - 1}$$
  - **Step 6: Final Calculation (Threshold = $4,000,000$ $\implies N=11$)**
      - $\phi^{3 \cdot 11} = \phi^{33}$
      - $\psi^{3 \cdot 11} = \psi^{33}$
      - $S_{\phi} = \frac{\phi^{36} - \phi^3 }{\phi^3 - 1}$
      - $S_{\psi} = \frac{\psi^{36} - \psi^3}{\psi^3 - 1}$
      - The total sum is:  $$\frac{S_{\phi} - S_{\psi}}{\sqrt{5}} \approx 4613732.000$$
      - The result is then **rounded** to the nearest integer to correct for floating-point imprecision, yielding the exact sum: **$4613732$**.
  - **Efficiency:** This is the most efficient solution as it avoids iteration through all Fibonacci terms, using only a handful of arithmetic and logarithmic operations.
-----

## Solution 2

### Approach

  - Generate the Fibonacci sequence iteratively, starting with $0$ and $1$.
  - In each step, check if the newly generated term is even.
  - If the term is even, add it to a running sum.
  - Stop when the generated term exceeds the threshold of four million.

**Reference:** The full Python implementation is available in [`solution_1.py`](solution_1.py).

### Detailed Explanation

  - **Step 1: Initialization**
      - Initialize `previous = 0` and `current = 1` to start the sequence generation.
      - Initialize `sum = 0` and `threshold = 4000000`.
  - **Step 2: Iteration and Sequence Generation**
      - The `while current < threshold:` loop continues as long as the current Fibonacci number is below four million.
      - Inside the loop, the next Fibonacci number is calculated: `previous, current = current, previous + current`. The old `current` becomes the new `previous`, and the sum of the old `previous` and `current` becomes the new `current`.
  - **Step 3: Check for Even Numbers**
      - We check the new `previous` (which is the old `current`, the term just added to the sequence) for evenness using modular arithmetic: `if not previous % 2:`.
  - **Step 4: Accumulating the sum**
      - If the term is even, it is added to the running `sum`.
----- 
## Solution 3
### Approach

  - Exploit the property that **every third Fibonacci number is even**.
      - The sequence pattern is: $\text{odd}, \text{odd}, \text{even}, \text{odd}, \text{odd}, \text{even}, \dots$
  - Use the modified recurrence relation for **even Fibonacci numbers** $E_n$:
    $$E_{n} = 4 \cdot E_{n-1} + E_{n-2}$$
  - This allows for the generation of only the even terms, significantly reducing the number of iterations.
  - Iterate using this modified recurrence relation and sum the terms until the threshold is exceeded.

**Reference:** The full Python implementation is available in [`solution_2.py`](solution_2.py).

### Detailed Explanation

  - **Step 1: Modified Initialization**
      - Initialize `previous = 0` and `current = 2` to correctly seed the even-term recurrence.
  - **Step 2: Modified Recurrence**
      - The relation $E_{n} = 4 \cdot E_{n-1} + E_{n-2}$ is implemented as: `previous, current = current, previous + 4 * current`.
      - The terms generated are $2, 8, 34, 144, \dots$ which are exactly the even terms.
  - **Step 3: Accumulating the sum**
      - The new `previous` (the term just added to the sequence) is added to the running `sum` in each iteration.
  - **Efficiency:** This method is much faster than Solution 1, performing only $\approx \frac{1}{3}$ the number of steps.



-----
## Solution 4: Iterative Summation with Binet's Formula


### Approach
- Identify even-term structure by recognizing that the $n$-th even Fibonacci number, $E_n$, is the $3n$-th regular Fibonacci number, $F_{3n}$.
- Adapt Binet's Formula by modifying it to directly calculate $E_n$ using $\phi^3$ and $\psi^3$ as the new bases.
- Use a `while` loop to repeatedly calculate the next even term, $\mathbf{E_N}$, and add it to a running `sum`.
- Apply a threshold correction since the loop adds the term that exceeds the `threshold` before terminating, subtract this final, over-limit term from the `sum`.
- Round the final floating-point sum to the nearest integer to correct for precision errors.

**Reference:** The full Python implementation is available in [`solution_4.py`](solution_4.py).


### Detailed Explanation

- **Step 1:** Constants and Adapted Binet's Formula
  - **Golden Ratio:** $\phi = \frac{1+\sqrt{5}}{2}$
  - **Conjugate:** $\psi = \frac{1-\sqrt{5}}{2}$
  - The $n$-th even Fibonacci number $E_n$ is calculated using the bases:
      * $\mathbf{ephi} = \phi^3$
      * $\mathbf{epsi} = \psi^3$
      * Formula: $$E_n = \frac{(\phi^3)^n - (\psi^3)^n}{\sqrt{5}}$$
- **Step 2:** Iteration and Summation
  - The code initializes $\mathbf{N=0}$, $\mathbf{sum=0}$, and $\mathbf{E\_N=0}$.
  - The `while E_N < threshold:` loop controls the process:
    1.  `N += 1`: The index $N$ increments (starting $N=1$).
    2.  `E_N = (ephi**N - epsi**N) / math.sqrt(5)`: The current even Fibonacci number is calculated.
    3.  `sum += E_N`: The newly calculated term is added to the running total.

- **Step 3:** Threshold Correction
  - The loop continues as long as the previously calculated $\mathbf{E\_N}$ is less than the threshold.
  - The loop's final iteration does the following:
    1.  Calculates $E_{12} = 5,702,887$ (The first term $\geq 4,000,000$).
    2.  Adds this over-limit value to the `sum`.
    3.  Terminates the loop because the new $E_{12}$ is not less than the threshold.
  - The line `sum -= E_N` removes this final, excess term ($5,702,887$) from the total, leaving only the sum of the terms below the threshold ($E_1$ through $E_{11}$).

- **Step 4:** Final Result

  * The total is calculated using floating-point numbers. Since the sum of integers must be an integer, the line `sum = round(sum)` corrects any minor floating-point errors.
  * The result printed is the exact integer sum: **$4613732$**.
- **Efficiency:** It avoids the standard, slower recursive definition of Fibonacci numbers. It avoids iterating through **all** Fibonacci numbers, only calculating every third one (the even terms).

-----
## Output

```
4613732
```

-----

## Notes

  - The problem uses the sequence starting $1, 2, 3, 5, \dots$. If using the standard mathematical indexing $F_1=1, F_2=1, F_3=2, \dots$, the terms used here are $F_2, F_3, F_4, \dots$.
  - **Solution 2** is the optimal iterative method, while **Solution 3** is the most efficient approach.
