# Problem 2: Even Fibonacci Numbers

**Problem source:** [Project Euler Problem 2](https://projecteuler.net/problem=2)

**Problem statement:**

Each new term in the **Fibonacci sequence** is generated by adding the previous two terms. By starting with $1$ and $2$, the first $10$ terms will be: $1, 2, 3, 5, 8, 13, 21, 34, 55, 89, \dots$.

By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the **even-valued terms**.

## Solution 1

### Approach

  - Generate the Fibonacci sequence iteratively, starting with $0$ and $1$.
  - In each step, check if the newly generated term is even.
  - If the term is even, add it to a running sum.
  - Stop when the generated term exceeds the threshold of four million.

**Reference:** The full Python implementation is available in [`solution_1.py`](solution_1.py).

### Detailed Explanation

  - **Step 1: Initialization**
      - Initialize `previous = 0` and `current = 1` to start the sequence generation.
      - Initialize `sum = 0` and `threshold = 4000000`.
  - **Step 2: Iteration and Sequence Generation**
      - The `while current < threshold:` loop continues as long as the current Fibonacci number is below four million.
      - Inside the loop, the next Fibonacci number is calculated: `previous, current = current, previous + current`. The old `current` becomes the new `previous`, and the sum of the old `previous` and `current` becomes the new `current`.
  - **Step 3: Check for Even Numbers**
      - We check the new `previous` (which is the old `current`, the term *just added* to the sequence) for evenness using modular arithmetic: `if not previous % 2:`.
  - **Step 4: Accumulating the sum**
      - If the term is even, it is added to the running `sum`.

-----

## Solution 2

### Approach

  - Exploit the property that **every third Fibonacci number is even**.
      - The sequence pattern is: $\text{odd}, \text{even}, \text{odd}, \text{even}, \text{odd}, \text{even}, \dots$
  - Use the modified recurrence relation for **even Fibonacci numbers** $E_n$:
    $$E_{n} = 4 \cdot E_{n-1} + E_{n-2}$$
  - This allows for the generation of *only* the even terms, significantly reducing the number of iterations.
  - Iterate using this modified recurrence relation and sum the terms until the threshold is exceeded.

**Reference:** The full Python implementation is available in [`solution_2.py`](solution_2.py).

### Detailed Explanation

  - **Step 1: Modified Initialization**
      - Initialize `previous = 0` and `current = 2` to correctly seed the even-term recurrence.
  - **Step 2: Modified Recurrence**
      - The relation $E_{n} = 4 \cdot E_{n-1} + E_{n-2}$ is implemented as: `previous, current = current, previous + 4 * current`.
      - The terms generated are $2, 8, 34, 144, \dots$ which are exactly the even terms.
  - **Step 3: Accumulating the sum**
      - The new `previous` (the term just added to the sequence) is added to the running `sum` in each iteration.
  - **Efficiency:** This method is much faster than Solution 1, performing only $\approx \frac{1}{3}$ the number of steps.

-----
## Solution 3

### Approach

  - Use **Binet's Formula** to find the $n$-th even Fibonacci number directly.
  - The $n$-th even Fibonacci number is $E_n = F_{3n}$, which can be expressed using the Golden Ratio $\phi$ and its conjugate $\psi$:
    $$E_n = \frac{(\phi^3)^n - (\psi^3)^n}{\sqrt{5}}$$
  - Calculate the index $N$ of the last even term below the threshold ($4,000,000$).
  - Use the **formula for the sum of a geometric series** to sum all $N$ terms directly, resulting in an $\mathcal{O}(1)$ solution.

**Reference:** The full Python implementation is available in [`solution_3.py`](https://www.google.com/search?q=solution_3.py).

### Detailed Explanation

  - **Step 1: Constants and Even Fibonacci Recurrence**
      - **Golden Ratio:** $\phi = \frac{1+\sqrt{5}}{2}$
      - **Conjugate:** $\psi = \frac{1-\sqrt{5}}{2}$ 
      - The base for the geometric series for even terms are $r_1 = \phi^3$ and $r_2 = \psi^3$.
          - $r_1 = \phi^3$  (`ephi`)
          - $r_2 = \psi^3$  (`epsi`)
  - **Step 2: Finding the Index $N$**
      - We solve for the largest integer $N$ such that $E_N < 4,000,000$.
      - This is found iteratively in the code: $N=12$.
      - The even terms are $E_1, E_2, \dots, E_{12}$. There are $N=12$ terms to sum.
  
  - **Step 3: Sum of Geometric Series**
      - The total sum $\sum_{n=1}^{N} E_n$ is:
        $$\text{Sum} = \frac{1}{\sqrt{5}} \left( \sum_{n=1}^{N} (\phi^3)^n - \sum_{n=1}^{N} (\psi^3)^n \right)$$
      - The sum of a geometric series $S_N = \sum_{n=1}^{N} r^n = \frac{r(r^N - 1)}{r - 1}$.
      - **Sum of Positive Part ($S_{\phi}$):** $r = \phi^3$
        $$S_{\phi} = \sum_{n=1}^{12} (\phi^3)^n = \frac{\phi^3 ((\phi^3)^{12} - 1)}{\phi^3 - 1}$$
      - **Sum of Negative Part ($S_{\psi}$):** $r = \psi^3$
        $$S_{\psi} = \sum_{n=1}^{12} (\psi^3)^n = \frac{\psi^3 ((\psi^3)^{12} - 1)}{\psi^3 - 1}$$
  - **Step 4: Final Calculation (Threshold $4,000,000$ $\implies N=12$)**
      - $\phi^{3 \cdot 12} = \phi^{36} \approx 1.4930352 \times 10^7$
      - $\psi^{3 \cdot 12} = \psi^{36} \approx 4.472136 \times 10^{-8}$
      - $S_{\phi} \approx \frac{4.236068 \cdot (14930352 - 1)}{4.236068 - 1} \approx 20387556.000$
      - $S_{\psi} \approx \frac{-0.236068 \cdot (4.47 \times 10^{-8} - 1)}{-0.236068 - 1} \approx 0.0000000447$
      - The total sum is:
        $$\text{Sum} = \frac{S_{\phi} - S_{\psi}}{\sqrt{5}} = \frac{20387556.000 - 0.0000000447}{\sqrt{5}} \approx 9123847.99999996 / 2.236068 \approx 4613732.000$$
      - The result is then **rounded** to the nearest integer to correct for floating-point imprecision, yielding the exact sum: **$4613732$**.
  - **Efficiency:** This is the most efficient solution as it is a **closed-form, $\mathcal{O}(1)$ solution** (excluding the initial loop to find $N$), requiring no iteration over the series terms themselves.

-----


### Approach

- Use **Binet's Formula** to find the $n$-th even Fibonacci number directly.  
- The $n$-th even Fibonacci number is $E_n = F_{3n}$, which can be expressed using the Golden Ratio $\phi$:  
  $$E_n = \frac{(\phi^3)^n - (\psi^3)^n}{\sqrt{5}}$$  
- Calculate the index $N$ of the last even term below the threshold.  
- Use the **formula for the sum of a geometric series** to sum all $N$ terms directly, resulting in an $\mathcal{O}(1)$ solution.  

**Reference:** The full Python implementation is available in [`solution_3.py`](solution_3.py).

### Detailed Explanation

- **Step 1: Finding the index $N$**  
  - The code iteratively solves for the smallest $N$ such that $E_N \ge 4,000,000$.  
  - The index $N - 1$ is the last term to be summed.  

- **Step 2: Sum of Geometric Series**  
  - The total sum $\sum_{n=1}^{N} E_n$ is a sum of two geometric series derived from Binet's formula components.  
  - The sum formula $S_N = \frac{a(r^N - 1)}{r - 1}$ is applied to the $\phi^3$ and $\psi^3$ parts.  

- **Step 3: Final Calculation**  
  - The final sum is calculated as:  
    $$\text{sum\even} = \frac{\sum (\phi^3)^n - \sum (\psi^3)^n}{\sqrt{5}}$$  
  - The result is rounded to the nearest integer to correct for floating-point errors.  

- **Efficiency:** This is the most efficient solution since it avoids a sequential loop over the Fibonacci terms.




## Output

```
4613732
```

-----

## Notes

  - The problem uses the sequence starting $1, 2, 3, 5, \dots$. If using the standard mathematical indexing $F_1=1, F_2=1, F_3=2, \dots$, the terms used here are $F_2, F_3, F_4, \dots$.
  - **Solution 2** is the optimal iterative method, while **Solution 3** is the most efficient, closed-form approach.
